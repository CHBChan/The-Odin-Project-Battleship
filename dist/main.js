(()=>{const e=e=>{let t=e,r=!1;const s=()=>{r=!0};return{hit:()=>{t-=1,t<=0&&s()},Sunk:s,isSunk:()=>r}},t=(e="AI")=>{let t=[],r=[];return{attack:s=>{if("AI"===e){for(coords of r)if(s.x===coords.x&&s.y===coords.y)return!1;let e=document.createElement("span");return e.setAttribute("class","material-icons"),e.innerHTML="close",document.querySelector(`.player.row${s.y}.col${s.x}`).appendChild(e),o.receiveAttack("AI",s),r.push(s),!0}if("player"===e){for(coords of t)if(s.x===coords.x&&s.y===coords.y)return!1;let e=document.createElement("span");return e.setAttribute("class","material-icons"),e.innerHTML="close",document.querySelector(`.ai.row${s.y}.col${s.x}`).appendChild(e),o.receiveAttack("player",s),t.push(s),!0}return!1}}};function r(){document.querySelectorAll(".cell").forEach((e=>{e.setAttribute("style","background-color: white")}))}(()=>{let e=document.querySelector(".content"),l=document.createElement("div");l.setAttribute("class","playerBoard"),l.classList.add("grid");let a=document.createElement("div");a.setAttribute("class","enemyBoard"),a.classList.add("grid");for(let e=0;e<7;e++)for(let t=0;t<7;t++){let r=document.createElement("div");r.setAttribute("class","player"),r.classList.add("cell"),r.classList.add("row"+e),r.classList.add("col"+t);let s=document.createElement("div");s.setAttribute("class","ai"),s.classList.add("cell"),s.classList.add("row"+e),s.classList.add("col"+t),l.appendChild(r),a.appendChild(s)}let n=document.createElement("p");n.setAttribute("class","message"),n.innerHTML="Place your carrier.";let i=document.createElement("button");i.setAttribute("class","rotateBtn"),i.innerHTML="Rotate",i.addEventListener("click",(()=>{s=0===s?1:0})),e.appendChild(l),e.appendChild(a),document.body.appendChild(n),document.body.appendChild(i);let c=0,p=[5,4,3,3,2],u=["carrier","battleship","destroyer","submarine","patrol"];l.addEventListener("mouseover",(function e(t){if(r(),t.target.classList.contains("cell")){let a=t.target.classList[3].substring(3),n=t.target.classList[2].substring(3);if(7-a>=p[c]*(1-s)&&7-n>=p[c]*s&&!o.checkOccupied("player",{x:a,y:n},p[c],s))for(let e=0;e<p[c];e++){let t=parseInt(a)+e*(1-s),r=parseInt(n)+e*s;document.querySelector(`.player.cell.row${r}.col${t}`).setAttribute("style","background-color: green")}else t.target.setAttribute("style","background-color: red");c>=5&&(r(),l.removeEventListener("mouseover",e))}})),l.addEventListener("mouseleave",(function e(){r(),c>=5&&l.removeEventListener("mouseleave",e)})),l.addEventListener("click",(function e(a){if(a.target.classList.contains("cell")){let i=a.target.classList[3].substring(3),d=a.target.classList[2].substring(3),h={x:i,y:d};if(7-i>=p[c]*(1-s)&&7-d>=p[c]*s&&!o.checkOccupied("player",h,p[c],s)){for(let e=0;e<p[c];e++){let t=parseInt(i)+e*(1-s),r=parseInt(d)+e*s,o=document.querySelector(`.player.cell.row${r}.col${t}`);o.setAttribute("style","background-color: gray"),o.classList.replace("cell","ship")}o.placeShip("player",u[c],h,1-s,s),c++,r(),n.innerHTML=`Place your ${u[c]}.`,c>=5&&(l.removeEventListener("click",e),l.setAttribute("style","cursor: not-allowed"),function(){p1=t("player"),p2=t();const e="Player",r="AI";let s,l=document.querySelector(".message");setTimeout((()=>{l.innerHTML="Your turn.",s=e}),2e3),l.innerHTML="AI is currently placing their ships...",function(){let e=0,t=[5,4,3,3,2],r=["carrier","battleship","destroyer","submarine","patrol"];for(;e<5;){let s=Math.round(Math.random()),l={x:Math.floor(Math.random()*(6-t[e]*(1-s))),y:Math.floor(Math.random()*(6-t[e]*s))};o.checkOccupied("AI",l,t[e],s)||(o.placeShip("AI",r[e],l,1-s,s),e++)}}(),document.querySelector(".rotateBtn").remove();let a=document.querySelector(".enemyBoard");a.addEventListener("click",(t=>{if(s===e&&t.target.classList.contains("cell")){let n=parseInt(t.target.classList[2].substring(3)),i={x:parseInt(t.target.classList[3].substring(3)),y:n};if(p1.attack(i)){if(s=r,a.setAttribute("style","cursor: not-allowed"),o.getAICount()<=0)return void(l.innerHTML="You destroyed all their ships, you win!");l.innerHTML="AI's turn...",setTimeout((()=>{let t=Math.floor(7*Math.random()),r=Math.floor(7*Math.random()),n={x:t,y:r};for(;!p2.attack(n);)t=Math.floor(7*Math.random()),r=Math.floor(7*Math.random()),n={x:t,y:r};o.getPlayerCount()<=0?l.innerHTML="The AI destroyed all your ship, you lose!":(s=e,l.innerHTML="Your turn.",a.setAttribute("style","cursor: pointer"))}),2e3)}}})),a.setAttribute("style","cursor: pointer")}())}}}))})();let s=0,o=(()=>{let t=[],r=[],s=0,o=0;return{placeShip:(l,a,n,i=0,c=0)=>{let p=[];if("player"===l){switch(a){case"carrier":let r=e(5);p=[];for(let e=0;e<5;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}t.push({ship:r,coords:p});break;case"battleship":let s=e(4);p=[];for(let e=0;e<4;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}t.push({ship:s,coords:p});break;case"destroyer":let o=e(3);p=[];for(let e=0;e<3;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}t.push({ship:o,coords:p});break;case"submarine":let l=e(3);p=[];for(let e=0;e<3;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}t.push({ship:l,coords:p});break;case"patrol":let a=e(2);p=[];for(let e=0;e<2;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}t.push({ship:a,coords:p})}s++}else{switch(a){case"carrier":let t=e(5);p=[];for(let e=0;e<5;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}r.push({ship:t,coords:p});break;case"battleship":let s=e(4);p=[];for(let e=0;e<4;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}r.push({ship:s,coords:p});break;case"destroyer":let o=e(3);p=[];for(let e=0;e<3;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}r.push({ship:o,coords:p});break;case"submarine":let l=e(3);p=[];for(let e=0;e<3;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}r.push({ship:l,coords:p});break;case"patrol":let a=e(2);p=[];for(let e=0;e<2;e++){let t=parseInt(n.x)+i*e,r=parseInt(n.y)+c*e;p.push({x:t,y:r})}r.push({ship:a,coords:p})}o++}},receiveAttack:(e,l)=>{if("player"===e){for(ship_info of r)for(shipCoord of ship_info.coords)if(l.x===shipCoord.x&&l.y===shipCoord.y)return document.querySelector(`.ai.row${l.y}.col${l.x}`).setAttribute("style","background-color: red"),ship_info.ship.hit(),ship_info.ship.isSunk()&&o--,!0;return!1}for(ship_info of t)for(shipCoord of ship_info.coords)if(l.x===shipCoord.x&&l.y===shipCoord.y)return document.querySelector(`.player.row${l.y}.col${l.x}`).setAttribute("style","background-color: red"),ship_info.ship.hit(),ship_info.ship.isSunk()&&s--,!0;return!1},checkOccupied:(e,s,o,l)=>{if("player"===e)for(ship_info of t)for(coord of ship_info.coords)for(let e=0;e<o;e++){let t=parseInt(s.x)+e*(1-l),r=parseInt(s.y)+e*l;if(t===coord.x&&r===coord.y)return!0}else for(ship_info of r)for(coord of ship_info.coords)for(let e=0;e<o;e++){let t=parseInt(s.x)+e*(1-l),r=parseInt(s.y)+e*l;if(t===coord.x&&r===coord.y)return!0}return!1},getPlayerCount:()=>s,getAICount:()=>o}})()})();